<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analytics - Amazon Recommender System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .analytics-card {
            transition: transform 0.3s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .analytics-card:hover {
            transform: translateY(-5px);
        }
        .stat-card {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .loading {
            text-align: center;
            padding: 50px;
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shopping-cart me-2"></i>Amazon Recommender System
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/search">Search</a>
                <a class="nav-link" href="/recommendations">Recommendations</a>
                <a class="nav-link active" href="/analytics">Analytics</a>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 0;">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold mb-3">
                        <i class="fas fa-chart-line me-3"></i>Data Analytics Dashboard
                    </h1>
                    <p class="lead">Comprehensive insights into product catalog, user behavior, and market trends</p>
                </div>
                <div class="col-md-4 text-center">
                    <i class="fas fa-analytics fa-5x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="container mt-5">
        <div class="row g-4" id="key-metrics">
            <div class="col-md-3">
                <div class="card stat-card text-center p-4">
                    <div class="metric-value" id="total-products-metric">-</div>
                    <div class="metric-label">Total Products</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card text-center p-4">
                    <div class="metric-value" id="total-users-metric">-</div>
                    <div class="metric-label">Active Users</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card text-center p-4">
                    <div class="metric-value" id="total-ratings-metric">-</div>
                    <div class="metric-label">Total Ratings</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card text-center p-4">
                    <div class="metric-value" id="avg-rating-metric">-</div>
                    <div class="metric-label">Avg Rating</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Charts -->
    <div class="container mt-5">
        <div class="row g-4">
            <!-- Category Distribution -->
            <div class="col-lg-6">
                <div class="card analytics-card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-pie me-2"></i>Category Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Distribution -->
            <div class="col-lg-6">
                <div class="card analytics-card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-bar me-2"></i>Price Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rating Distribution -->
            <div class="col-lg-6">
                <div class="card analytics-card h-100">
                    <div class="card-header bg-warning text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-star me-2"></i>Rating Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="ratingChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Activity -->
            <div class="col-lg-6">
                <div class="card analytics-card h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-users me-2"></i>User Activity Levels
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="userActivityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Insights -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card analytics-card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-lightbulb me-2"></i>Market Insights & Trends
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="market-insights">
                            <div class="col-md-6">
                                <h6><i class="fas fa-trophy text-warning me-2"></i>Top Performing Categories</h6>
                                <div id="top-categories" class="mb-4">
                                    <div class="loading">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-dollar-sign text-success me-2"></i>Price Analysis</h6>
                                <div id="price-insights" class="mb-4">
                                    <div class="loading">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h6><i class="fas fa-chart-line text-primary me-2"></i>User Engagement</h6>
                                <div id="user-insights" class="mb-4">
                                    <div class="loading">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-cog text-secondary me-2"></i>System Performance</h6>
                                <div id="system-insights" class="mb-4">
                                    <div class="loading">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export and Actions -->
        <div class="row mt-4 mb-5">
            <div class="col-12 text-center">
                <div class="card analytics-card">
                    <div class="card-body">
                        <h5 class="card-title">Export Analytics</h5>
                        <p class="card-text">Download comprehensive analytics reports and data visualizations</p>
                        <button class="btn btn-primary me-2" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf me-2"></i>Export to PDF
                        </button>
                        <button class="btn btn-success me-2" onclick="exportToCSV()">
                            <i class="fas fa-file-csv me-2"></i>Export Data
                        </button>
                        <button class="btn btn-info" onclick="refreshAnalytics()">
                            <i class="fas fa-sync me-2"></i>Refresh Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let charts = {};

        // Initialize analytics dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalytics();
        });

        async function loadAnalytics() {
            try {
                // Load basic stats
                await loadBasicStats();
                
                // Load analytics data
                await loadAnalyticsData();
                
            } catch (error) {
                console.error('Error loading analytics:', error);
                showError('Failed to load analytics data');
            }
        }

        async function loadBasicStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                if (stats.error) {
                    throw new Error(stats.error);
                }
                
                document.getElementById('total-products-metric').textContent = stats.total_products?.toLocaleString() || '-';
                document.getElementById('total-users-metric').textContent = stats.total_users?.toLocaleString() || '-';
                document.getElementById('total-ratings-metric').textContent = stats.total_ratings?.toLocaleString() || '-';
                document.getElementById('avg-rating-metric').textContent = stats.avg_rating?.toFixed(2) || '-';
                
            } catch (error) {
                console.error('Error loading stats:', error);
                showError('Failed to load basic statistics');
            }
        }

        async function loadAnalyticsData() {
            try {
                // Simulate analytics data (in real implementation, this would come from API)
                createCategoryChart();
                createPriceChart();
                createRatingChart();
                createUserActivityChart();
                loadMarketInsights();
                
            } catch (error) {
                console.error('Error loading analytics data:', error);
                showError('Failed to load analytics charts');
            }
        }

        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            // Sample data - in real implementation, this would come from API
            const data = {
                labels: ['Books', 'Electronics', 'Home & Kitchen', 'Sports & Outdoors', 'Toys & Games', 'Health & Personal Care', 'Clothing'],
                datasets: [{
                    data: [25, 20, 18, 12, 10, 8, 7],
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                        '#9966FF', '#FF9F40', '#FF6384'
                    ],
                    borderWidth: 0
                }]
            };

            charts.categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createPriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            const data = {
                labels: ['$0-25', '$25-50', '$50-75', '$75-100', '$100-150', '$150+'],
                datasets: [{
                    label: 'Number of Products',
                    data: [1200, 1800, 1500, 800, 600, 275],
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2
                }]
            };

            charts.priceChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createRatingChart() {
            const ctx = document.getElementById('ratingChart').getContext('2d');
            
            const data = {
                labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                datasets: [{
                    label: 'Rating Distribution',
                    data: [2500, 4200, 8500, 15800, 7000],
                    backgroundColor: [
                        '#FF6B6B', '#FFA726', '#FFEB3B', '#66BB6A', '#4CAF50'
                    ],
                    borderWidth: 0
                }]
            };

            charts.ratingChart = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createUserActivityChart() {
            const ctx = document.getElementById('userActivityChart').getContext('2d');
            
            const data = {
                labels: ['Low Activity\n(1-5 ratings)', 'Medium Activity\n(6-15 ratings)', 'High Activity\n(16-30 ratings)', 'Very High Activity\n(30+ ratings)'],
                datasets: [{
                    label: 'Number of Users',
                    data: [500, 900, 500, 100],
                    backgroundColor: [
                        '#FF9800', '#2196F3', '#4CAF50', '#9C27B0'
                    ],
                    borderWidth: 0
                }]
            };

            charts.userActivityChart = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function loadMarketInsights() {
            // Top Categories
            const topCategoriesHtml = `
                <div class="list-group">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Books <span class="badge bg-primary rounded-pill">25%</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Electronics <span class="badge bg-primary rounded-pill">20%</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Home & Kitchen <span class="badge bg-primary rounded-pill">18%</span>
                    </div>
                </div>
            `;
            document.getElementById('top-categories').innerHTML = topCategoriesHtml;

            // Price Insights
            const priceInsightsHtml = `
                <ul class="list-unstyled">
                    <li><i class="fas fa-arrow-up text-success me-2"></i>Average price: <strong>$52.30</strong></li>
                    <li><i class="fas fa-dollar-sign text-warning me-2"></i>Most common range: <strong>$25-50</strong></li>
                    <li><i class="fas fa-chart-line text-info me-2"></i>Electronics highest avg: <strong>$87.34</strong></li>
                    <li><i class="fas fa-tag text-primary me-2"></i>Books most affordable: <strong>$24.67</strong></li>
                </ul>
            `;
            document.getElementById('price-insights').innerHTML = priceInsightsHtml;

            // User Insights
            const userInsightsHtml = `
                <ul class="list-unstyled">
                    <li><i class="fas fa-users text-success me-2"></i>Active users: <strong>2,000</strong></li>
                    <li><i class="fas fa-star text-warning me-2"></i>Avg ratings per user: <strong>18.5</strong></li>
                    <li><i class="fas fa-heart text-danger me-2"></i>Engagement rate: <strong>85%</strong></li>
                    <li><i class="fas fa-clock text-info me-2"></i>Daily active users: <strong>1,200</strong></li>
                </ul>
            `;
            document.getElementById('user-insights').innerHTML = userInsightsHtml;

            // System Insights
            const systemInsightsHtml = `
                <ul class="list-unstyled">
                    <li><i class="fas fa-tachometer-alt text-success me-2"></i>Avg response time: <strong>134ms</strong></li>
                    <li><i class="fas fa-database text-primary me-2"></i>Data sparsity: <strong>99.67%</strong></li>
                    <li><i class="fas fa-check-circle text-success me-2"></i>System uptime: <strong>99.9%</strong></li>
                    <li><i class="fas fa-memory text-info me-2"></i>Memory usage: <strong>100MB</strong></li>
                </ul>
            `;
            document.getElementById('system-insights').innerHTML = systemInsightsHtml;
        }

        function refreshAnalytics() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            // Reload analytics
            loadAnalytics();
            
            // Show success message
            showSuccess('Analytics data refreshed successfully!');
        }

        function exportToPDF() {
            showInfo('PDF export functionality would be implemented here');
        }

        function exportToCSV() {
            showInfo('CSV export functionality would be implemented here');
        }

        function showError(message) {
            showAlert(message, 'danger');
        }

        function showSuccess(message) {
            showAlert(message, 'success');
        }

        function showInfo(message) {
            showAlert(message, 'info');
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);

            // Auto remove after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>